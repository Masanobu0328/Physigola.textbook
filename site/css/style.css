/* ==========================================================================
   Physio Golazo Web Textbook - Professional Design System v2.0
   Supports: Mobile, Tablet, Desktop, and A4 PDF Output
   ========================================================================== */

/* --------------------------------------------------------------------------
   1. Design Tokens & Variables
   -------------------------------------------------------------------------- */
:root {
  /* Brand Palette - Professional & Trustworthy */
  --color-brand-primary: #E09000;
  /* Energetic Orange */
  --color-brand-dark: #B37300;
  /* Deep Orange */
  --color-brand-light: #FFB84D;
  /* Soft Orange */

  --color-accent-success: #2A7A4B;
  /* Medical Green */
  --color-accent-info: #006699;
  /* Info Blue */
  --color-accent-warning: #D97706;
  /* Warning Amber */
  --color-accent-danger: #C53030;
  /* Alert Red */

  /* Neutral Palette - Optimized for Screen Reading */
  --color-text-main: #2D3748;
  /* Nearly Black (Softer than #000) */
  --color-text-sub: #4A5568;
  /* Dark Gray */
  --color-text-muted: #718096;
  /* Muted Gray */

  --color-bg-body: #F7FAFC;
  /* Very Light Gray (Easier on eyes) */
  --color-bg-paper: #FFFFFF;
  /* Pure White for Content Cards */
  --color-bg-subtle: #EDF2F7;
  /* Light Gray for Sections */

  --color-border: #E2E8F0;

  /* Typography - Mobile Optimized */
  --font-family-base: "Noto Sans JP", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-size-base: 16px;
  /* Browser Default Base */
  --line-height-base: 1.75;
  /* Relaxed for reading */
  --letter-spacing-base: 0.05em;
  /* Improved legibility */

  /* Spacing System (8px grid) */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  /* Mobile Standard Padding */
  --space-6: 24px;
  --space-8: 32px;
  --space-12: 48px;
  --space-16: 64px;

  /* Elevation (Shadows) */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

  /* Radius */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 16px;
  --radius-full: 9999px;

  /* Layout */
  --header-height: 60px;
  --max-width-text: 720px;
  /* Optimal reading width */
}

/* --------------------------------------------------------------------------
   2. Reset & Base Styles
   -------------------------------------------------------------------------- */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: 100%;
  scroll-behavior: smooth;
  scroll-padding-top: calc(var(--header-height) + var(--space-4));
}

body {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  line-height: var(--line-height-base);
  letter-spacing: var(--letter-spacing-base);
  color: var(--color-text-main);
  background-color: var(--color-bg-body);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  color: var(--color-brand-dark);
  text-decoration: none;
  border-bottom: 1px dotted var(--color-brand-dark);
  transition: all 0.2s ease;
}

a:hover {
  color: var(--color-brand-primary);
  border-bottom-style: solid;
}

img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-sm);
}

/* --------------------------------------------------------------------------
   3. Typography Component
   -------------------------------------------------------------------------- */
h1,
h2,
h3,
h4,
h5,
h6 {
  color: var(--color-text-main);
  line-height: 1.3;
  margin-top: 0;
}

/* Chapter Title */
h1 {
  font-size: clamp(0.7rem, 6vw, 1.75rem);
  /* Aggressively shrink to keep on 1 line */
  font-weight: 700;
  margin-bottom: var(--space-4);
  text-align: center;
  /* Explicit Center */
  white-space: nowrap;
  /* Rigid 1-line rule */
  width: 100%;
  overflow: hidden;
  line-height: 1.2;
}

/* Section Heading */
h2 {
  font-size: clamp(0.9rem, 4.5vw, 1.5rem);
  /* Responsive 1-line sizing */
  background: linear-gradient(to right, rgba(224, 144, 0, 0.1), transparent);
  border-left: 5px solid var(--color-brand-primary);
  padding: var(--space-2) var(--space-3);
  margin-top: var(--space-12);
  margin-bottom: var(--space-6);
  display: flex;
  align-items: center;
  white-space: nowrap;
  /* Rigid 1-line rule */
  text-align: left;
  /* Explicit Left */
  width: 100%;
  overflow: hidden;
}

/* Subsection Heading */
h3 {
  font-size: clamp(0.85rem, 4vw, 1.25rem);
  /* Responsive 1-line sizing */
  font-weight: 700;
  color: var(--color-brand-dark);
  margin-top: var(--space-8);
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-2);
  border-bottom: 2px solid var(--color-border);
  white-space: nowrap;
  /* Rigid 1-line rule */
  text-align: left;
  /* Explicit Left */
  width: 100%;
  overflow: hidden;
}

p {
  margin-bottom: var(--space-6);
  text-align: left;
  /* Explicit Left, strictly no justify or styling weirdness */
  line-height: 1.8;
}

strong {
  font-weight: 700;
  color: var(--color-brand-dark);
  /* Highlight keywords subtly */
}

/* --------------------------------------------------------------------------
   4. Layout Components
   -------------------------------------------------------------------------- */
.page-wrapper {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

.container {
  width: 100%;
  max-width: var(--max-width-text);
  /* Reading optimized width */
  margin: 0 auto;
  padding: 0 var(--space-4);
}

.main-content {
  flex: 1;
  padding-top: calc(var(--header-height) + var(--space-6));
  padding-bottom: var(--space-16);
  background-color: var(--color-bg-paper);
  /* Paper effect */
  box-shadow: var(--shadow-sm);
  margin: 0 auto;
  width: 100%;
  max-width: 900px;
  /* Slightly wider than text for padding */
}

/* Small adjustments for desktop constraints */
@media (min-width: 900px) {
  .main-content {
    margin-top: var(--space-8);
    margin-bottom: var(--space-8);
    border-radius: var(--radius-lg);
    padding: var(--space-12) var(--space-12);
    /* More breathing room */
    box-shadow: var(--shadow-md);
  }
}

/* --------------------------------------------------------------------------
   5. Sticky Header & Navigation
   -------------------------------------------------------------------------- */
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--header-height);
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--color-border);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 var(--space-4);
  box-shadow: var(--shadow-sm);
}

.header__logo img {
  height: 32px;
  width: auto;
}

.header__nav a {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--color-text-sub);
  border: none;
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
}

.header__nav a:hover {
  background-color: var(--color-bg-subtle);
  color: var(--color-brand-primary);
}

/* --------------------------------------------------------------------------
   6. UI Components (Cards, Notes, Tables)
   -------------------------------------------------------------------------- */

/* Chapter Title Header */
.chapter-hero {
  text-align: center;
  margin-bottom: var(--space-12);
  border-bottom: 1px solid var(--color-border);
  padding-bottom: var(--space-8);
}

.chapter-badge {
  display: inline-block;
  background-color: var(--color-brand-primary);
  color: white;
  font-size: 0.8rem;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: var(--radius-full);
  margin-bottom: var(--space-3);
  letter-spacing: 0.1em;
}

.chapter-subtitle {
  font-size: clamp(0.7rem, 3.5vw, 1.1rem);
  /* Dynamic sizing */
  color: var(--color-text-sub);
  font-weight: 400;
  white-space: nowrap;
  /* Prevent 2 lines */
  overflow: hidden;
  text-align: center;
  /* Explicit Center */
  display: block;
}

/* Note Boxes */
.note-box {
  background-color: var(--color-bg-subtle);
  border-left: 4px solid var(--color-brand-primary);
  padding: var(--space-4) var(--space-6);
  margin: var(--space-8) 0;
  border-radius: 0 var(--radius-md) var(--radius-md) 0;
}

.note-box--warning {
  background-color: #FFFBEB;
  /* Amber 50 */
  border-left-color: var(--color-accent-warning);
}

.note-box--info {
  background-color: #EBF8FF;
  /* Blue 50 */
  border-left-color: var(--color-accent-info);
}

.note-box__title {
  display: block;
  font-weight: 700;
  font-size: clamp(0.8rem, 4vw, 0.95rem);
  /* Responsive font size */
  margin-bottom: var(--space-2);
  color: var(--color-text-main);
  display: flex;
  align-items: center;
  gap: var(--space-2);
  white-space: nowrap;
  /* Prevent 2 lines */
  text-align: left;
  /* Explicit Left */
  overflow: hidden;
}

/* Tables (Responsive Card style on mobile) */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  /* Smooth scrolling on iOS */
  margin: var(--space-8) 0;
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
  background: white;
  min-width: 600px;
  /* Force scroll on small screens if needed */
}

th,
td {
  padding: var(--space-3) var(--space-4);
  text-align: left;
  border-bottom: 1px solid var(--color-border);
}

th {
  background-color: var(--color-bg-subtle);
  font-weight: 700;
  color: var(--color-text-sub);
  white-space: nowrap;
}

tr:last-child td {
  border-bottom: none;
}

/* Diagrams / Flowcharts */
.diagram-container {
  background: white;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--space-6);
  margin: var(--space-8) 0;
  text-align: center;
}

.diagram-step {
  display: flex;
  align-items: center;
  background: var(--color-bg-subtle);
  padding: var(--space-4);
  margin-bottom: var(--space-2);
  border-radius: var(--radius-md);
  text-align: left;
}

.diagram-step__num {
  background-color: var(--color-brand-primary);
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.8rem;
  margin-right: var(--space-4);
  flex-shrink: 0;
}

.diagram-arrow {
  display: block;
  color: var(--color-text-muted);
  font-size: 1.2rem;
  margin: var(--space-1) 0;
}

/* References */
.references-section {
  margin-top: var(--space-16);
  padding-top: var(--space-8);
  border-top: 1px solid var(--color-border);
}

.reference-item {
  font-size: 0.85rem;
  color: var(--color-text-sub);
  margin-bottom: var(--space-3);
  padding-left: var(--space-2);
  line-height: 1.5;
}

.reference-item a {
  color: var(--color-accent-info);
  border-bottom: none;
  font-family: monospace;
}

/* --------------------------------------------------------------------------
   7. Navigation (Next/Prev)
   -------------------------------------------------------------------------- */
.chapter-nav {
  display: flex;
  justify-content: space-between;
  gap: var(--space-4);
  margin-top: var(--space-12);
  padding-top: var(--space-8);
}

.nav-button {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-4);
  background-color: white;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  color: var(--color-text-main);
  font-weight: 700;
  box-shadow: var(--shadow-sm);
  border-bottom: none !important;
}

.nav-button:hover {
  background-color: var(--color-bg-subtle);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.nav-button--primary {
  background-color: var(--color-brand-primary);
  color: white;
  border-color: var(--color-brand-primary);
}

.nav-button--primary:hover {
  background-color: var(--color-brand-dark);
}

/* --------------------------------------------------------------------------
   8. Cover & TOC Extensions
   -------------------------------------------------------------------------- */
/* Fullscreen Cover */
.cover-page {
  min-height: 100vh;
  background: radial-gradient(circle at center, #2D3748 0%, #1A202C 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: var(--space-6);
}

.cover-card {
  max-width: 400px;
  width: 100%;
  border-radius: var(--radius-lg);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  transition: transform 0.3s ease;
}

.cover-card:hover {
  transform: scale(1.02);
}

.btn-cover {
  margin-top: var(--space-8);
  background: var(--color-brand-primary);
  color: white;
  font-size: 1.25rem;
  font-weight: 700;
  padding: var(--space-4) var(--space-12);
  border-radius: var(--radius-full);
  box-shadow: 0 4px 14px 0 rgba(224, 144, 0, 0.39);
  transition: all 0.2s ease;
  border: none;
}

.btn-cover:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(224, 144, 0, 0.23);
  color: white;
}

/* TOC Styled List */
.toc-list {
  list-style: none;
  padding: 0;
}

.toc-card {
  display: block;
  background: white;
  border: 1px solid var(--color-border);
  border-left: 4px solid var(--color-brand-primary);
  padding: var(--space-4);
  margin-bottom: var(--space-4);
  border-radius: var(--radius-md);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border-bottom: none;
}

.toc-card:hover {
  transform: translateX(4px);
  box-shadow: var(--shadow-md);
  border-left-width: 6px;
}

.toc-num {
  font-size: 2rem;
  font-weight: 900;
  color: rgba(0, 0, 0, 0.05);
  line-height: 1;
  position: absolute;
  right: var(--space-4);
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

.toc-card {
  position: relative;
  overflow: hidden;
}

/* --------------------------------------------------------------------------
   9. Print / PDF Optimization (A4 Output)
   -------------------------------------------------------------------------- */
@media print {
  @page {
    size: A4;
    margin: 20mm;
    /* Standard A4 margin */
  }

  body {
    background: white;
    font-size: 11pt;
    /* Print standard size */
    color: black;
    line-height: 1.4;
    /* Tighter for print */
  }

  .main-content {
    box-shadow: none;
    padding: 0;
    margin: 0;
    width: 100%;
    max-width: none;
  }

  /* Hide navigation elements */
  .header,
  .chapter-nav,
  .floating-btn,
  .banner,
  .footer {
    display: none !important;
  }

  /* Typography tweaks */
  h1 {
    font-size: 18pt;
    margin-bottom: 20px;
  }

  h2 {
    font-size: 14pt;
    margin-top: 30px;
    border-bottom: 1px solid black;
    background: none;
    padding-left: 0;
  }

  h3 {
    font-size: 12pt;
    margin-top: 20px;
  }

  /* Link handling for PDF */
  a {
    color: black;
    text-decoration: none;
    border: none;
  }

  /* Append URL to links so they are visible on paper if needed? 
     User requested PDF for reading, so clickable links in PDF are better.
     We will NOT append URLs as text, assuming digital PDF use. 
  */

  /* Break rules */
  h1,
  h2,
  h3 {
    break-after: avoid;
  }

  img,
  table,
  .diagram-container,
  .note-box {
    break-inside: avoid;
  }

  p {
    orphans: 3;
    widows: 3;
  }

  /* Visuals for print */
  .note-box {
    border: 1px solid #ccc;
    background: none;
    border-left: 4px solid black;
  }

  .table-responsive {
    border: none;
    box-shadow: none;
  }

  table {
    border: 1px solid #000;
  }

  th,
  td {
    border: 1px solid #000;
  }
}

/* =========================================
   Protocol & Diagram Components
   ========================================= */

.protocol-box {
  background: var(--color-bg-light);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-6);
  margin: var(--space-6) 0;
}

.protocol-title {
  text-align: center;
  font-weight: 700;
  color: var(--color-brand-primary);
  margin-bottom: var(--space-4);
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
}

.protocol-title::before,
.protocol-title::after {
  content: "";
  height: 1px;
  width: 30px;
  background: var(--color-border);
}

/* Vertical Flow Chart (Mobile Friendly) */
.flow-chart {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  max-width: 400px;
  margin: 0 auto;
}

.flow-step {
  background: white;
  border: 2px solid var(--color-border);
  padding: var(--space-3);
  text-align: center;
  border-radius: var(--radius-md);
  font-weight: 700;
  position: relative;
  box-shadow: var(--shadow-sm);
  color: var(--color-text-main);
  line-height: 1.4;
}

.flow-step:last-child {
  margin-bottom: 0;
}

/* Connector Arrow */
.flow-step:not(:last-child)::after {
  content: "▼";
  position: absolute;
  bottom: -22px;
  /* Adjusted to sit between gaps */
  left: 50%;
  transform: translateX(-50%);
  color: var(--color-border);
  font-size: 0.8rem;
}

/* Step Variants */
.flow-step--start {
  background: var(--color-brand-primary);
  color: white;
  border-color: var(--color-brand-primary);
}

.flow-step--start:not(:last-child)::after {
  /* Arrow color remains neutral or matches based on design preference */
  color: var(--color-border);
}

.flow-step--action {
  border-color: var(--color-brand-muted);
}

.flow-step--danger {
  border-color: var(--color-accent-error);
  color: var(--color-accent-error);
  background: #FFF5F5;
}

.flow-step--decision {
  border-radius: 50px;
  /* Rounded for decision */
  border-style: dashed;
}

/* Phase/Step Process (e.g. RTP) */
.phase-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.phase-item {
  display: flex;
  align-items: stretch;
  background: white;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

.phase-num {
  background: var(--color-bg-light);
  color: var(--color-brand-primary);
  font-weight: 800;
  padding: var(--space-3);
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 50px;
  border-right: 1px solid var(--color-border);
  font-size: 1.2rem;
}

.phase-content {
  padding: var(--space-3);
  flex: 1;
}

.phase-title {
  font-weight: 700;
  font-size: 0.95rem;
  margin-bottom: 4px;
  color: var(--color-text-main);
}

.phase-desc {
  font-size: 0.85rem;
  color: var(--color-text-sub);
}

/* =========================================
   Evaluation Tools & Forms
   ========================================= */

.tool-dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: var(--space-6);
  margin-top: var(--space-8);
}

.tool-card {
  display: flex;
  flex-direction: column;
  background: white;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--space-6);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  border-bottom: none !important;
}

.tool-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
  border-color: var(--color-brand-primary);
}

.tool-card__icon {
  font-size: 2rem;
  margin-bottom: var(--space-4);
  color: var(--color-brand-primary);
}

.tool-card__title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-main);
  margin-bottom: var(--space-2);
}

.tool-card__desc {
  font-size: 0.9rem;
  color: var(--color-text-sub);
  margin-bottom: var(--space-6);
  flex: 1;
}

.tool-card__btn {
  align-self: flex-start;
  background-color: var(--color-bg-subtle);
  color: var(--color-brand-dark);
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-full);
  font-weight: 700;
  font-size: 0.85rem;
  transition: all 0.2s ease;
}

.tool-card:hover .tool-card__btn {
  background-color: var(--color-brand-primary);
  color: white;
}

/* Evaluation Form Container */
.eval-form {
  background: white;
  padding: var(--space-6);
  border-radius: var(--radius-lg);
  margin-top: var(--space-6);
}

.eval-section {
  margin-bottom: var(--space-12);
  padding-bottom: var(--space-8);
  border-bottom: 1px solid var(--color-border);
}

.eval-section:last-child {
  border-bottom: none;
}

.eval-section__title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--color-brand-dark);
  margin-bottom: var(--space-4);
  background: var(--color-bg-subtle);
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-md);
}

.eval-item {
  display: flex;
  align-items: flex-start;
  padding: var(--space-3) 0;
  border-bottom: 1px solid var(--color-bg-subtle);
}

.eval-item:last-child {
  border-bottom: none;
}

.eval-item__input {
  margin-top: 6px;
  margin-right: var(--space-4);
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.eval-item__label {
  font-size: 1rem;
  color: var(--color-text-main);
  cursor: pointer;
  line-height: 1.5;
}

/* Input Fields */
.form-input {
  width: 100%;
  padding: var(--space-3) var(--space-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-family: inherit;
  font-size: 1rem;
  margin-top: var(--space-2);
}

.form-input:focus {
  outline: none;
  border-color: var(--color-brand-primary);
  box-shadow: 0 0 0 3px rgba(224, 144, 0, 0.1);
}

/* Tool Actions */
.tool-actions {
  position: sticky;
  bottom: var(--space-4);
  display: flex;
  gap: var(--space-4);
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  padding: var(--space-4);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-lg);
  margin-top: var(--space-8);
  justify-content: center;
  z-index: 100;
}

.btn-report {
  background-color: var(--color-brand-primary);
  color: white;
  border: none;
  padding: var(--space-3) var(--space-8);
  border-radius: var(--radius-full);
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: var(--space-2);
  transition: all 0.2s ease;
}

.btn-report:hover {
  background-color: var(--color-brand-dark);
  transform: translateY(-2px);
}

/* Print Overrides for Evaluation Sheets */
@media print {

  .tool-actions,
  .eval-item__input {
    display: none !important;
  }

  .eval-item {
    padding: var(--space-2) 0;
  }

  .eval-item__label::before {
    content: "□ ";
    font-family: monospace;
  }

  .eval-item--checked .eval-item__label::before {
    content: "☑ ";
  }

  .eval-form {
    padding: 0;
  }
}